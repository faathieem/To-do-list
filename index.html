<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TaskMaster Aesthetic - To-Do List Interaktif</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

  :root {
    --green: #20c997;
    --background-light: #f0f4f8;
    --background-dark: #121212;
    --glass-bg: rgba(255, 255, 255, 0.15);
    --font-color-light: #222;
    --font-color-dark: #eee;
    --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
  }

  * {
    box-sizing: border-box;
    scroll-behavior: smooth;
  }

  body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    min-height: 100vh;
    background: var(--background-light);
    color: var(--font-color-light);
    transition: background 0.5s, color 0.5s;
    backdrop-filter: blur(20px);
  }

  body.dark {
    background: var(--background-dark);
    color: var(--font-color-dark);
  }

  .container {
    max-width: 600px;
    margin: 2rem auto;
    padding: 1rem 2rem 3rem;
    background: var(--glass-bg);
    border-radius: 15px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(12px);
  }

  header {
    text-align: center;
    margin-bottom: 1.5rem;
  }

  header h1 {
    font-weight: 600;
    font-size: 2.8rem;
    margin-bottom: 0.2rem;
    letter-spacing: 2px;
    color: var(--green);
  }

  header p {
    font-weight: 500;
    font-size: 1.15rem;
    user-select: none;
  }

  #themeToggle {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--green);
    border: none;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    color: white;
    font-weight: 700;
    font-size: 1.2rem;
    cursor: pointer;
    box-shadow: var(--shadow);
    transition: background 0.3s;
  }

  #themeToggle:hover {
    background: #17a2b8;
  }

  form {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.2rem;
  }

  input[type="text"] {
    flex-grow: 1;
    padding: 0.9rem 1rem;
    border-radius: 50px;
    border: 2px solid var(--green);
    outline: none;
    font-size: 1rem;
    transition: border-color 0.3s;
    background: transparent;
    color: inherit;
  }

  input[type="text"]::placeholder {
    color: rgba(0,0,0,0.5);
  }

  input[type="text"]:focus {
    border-color: #17a2b8;
  }

  button#addTask {
    background: var(--green);
    border: none;
    border-radius: 50px;
    padding: 0 1.4rem;
    color: white;
    font-weight: 600;
    cursor: pointer;
    box-shadow: var(--shadow);
    transition: background 0.3s;
  }

  button#addTask:hover {
    background: #17a2b8;
  }

  .filters {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .filters button {
    background: transparent;
    border: 2px solid var(--green);
    border-radius: 50px;
    padding: 0.4rem 1rem;
    font-weight: bold;
    cursor: pointer;
    color: var(--green);
    transition: 0.3s;
  }

  .filters button.active, .filters button:hover {
    background: var(--green);
    color: white;
  }

  ul#taskList {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  li.task-item {
    background: var(--glass-bg);
    margin-bottom: 1rem;
    padding: 1rem 1.5rem;
    border-radius: 15px;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: var(--shadow);
    transition: box-shadow 0.3s ease;
  }

  li.task-item:hover {
    box-shadow: 0 0 12px var(--green);
  }

  li.task-item.completed {
    text-decoration: line-through;
    opacity: 0.6;
  }

  li.task-item input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
    accent-color: var(--green);
  }

  li.task-item span.task-text {
    flex-grow: 1;
    font-size: 1.1rem;
  }

  li.task-item .btn-delete {
    background: #dc3545;
    border: none;
    border-radius: 50px;
    padding: 0.3rem 0.8rem;
    color: white;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.3s;
  }

  li.task-item .btn-delete:hover {
    background: #a71d2a;
  }

  .points-container {
    margin-top: 1.5rem;
    background: var(--glass-bg);
    padding: 1rem 1.5rem;
    border-radius: 15px;
    text-align: center;
    box-shadow: var(--shadow);
  }

  .points-container span {
    font-weight: 700;
    font-size: 2rem;
    color: var(--green);
  }

  /* Progress bar styles */
  .progress-bar {
    height: 16px;
    width: 100%;
    background: #ddd;
    border-radius: 8px;
    overflow: hidden;
    margin-top: 0.75rem;
  }

  .progress-fill {
    height: 100%;
    background: var(--green);
    transition: width 0.5s ease;
  }

  /* Drag handle */
  li.task-item .drag-handle {
    cursor: grab;
    font-size: 1.4rem;
    margin-right: 0.7rem;
    color: var(--green);
    user-select: none;
  }

  /* Search bar */
  #searchInput {
    width: 100%;
    padding: 0.8rem 1rem;
    border-radius: 50px;
    border: 2px solid var(--green);
    margin-bottom: 1rem;
    font-size: 1rem;
    outline: none;
    background: transparent;
    color: inherit;
  }

  /* Notification permission message */
  #notificationMessage {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--green);
    color: white;
    padding: 0.8rem 1.6rem;
    border-radius: 30px;
    box-shadow: var(--shadow);
    font-weight: 600;
    display: none;
  }
</style>
</head>
<body>
<button id="themeToggle" title="Toggle Dark/Light Mode">ðŸŒ™</button>

<div class="container" role="main" aria-label="TaskMaster To-Do List Aesthetic">
  <header>
    <h1>TaskMaster</h1>
    <p>To-Do List Praktis & Interaktif | Poin Kamu: <span id="totalPoints" class="points">0</span></p>
  </header>

  <input type="text" id="searchInput" placeholder="Cari tugas..." aria-label="Cari tugas" />

  <form id="taskForm" aria-label="Tambah Tugas Baru">
    <input
      type="text"
      id="taskInput"
      placeholder="Masukkan tugas baru (misal: Kerjakan PR Matematika)"
      aria-required="true"
      autocomplete="off"
    />
    <button id="addTask" type="submit" aria-label="Tambah tugas baru">Tambah</button>
  </form>

  <div class="filters" role="group" aria-label="Filter tugas">
    <button id="showAll" class="active" aria-pressed="true">Semua</button>
    <button id="showPending" aria-pressed="false">Belum Selesai</button>
    <button id="showCompleted" aria-pressed="false">Selesai</button>
  </div>

  <ul id="taskList" tabindex="0" aria-live="polite" aria-label="Daftar tugas">
    <!-- Tugas muncul di sini -->
  </ul>

  <div class="points-container" aria-live="polite">
    Level Kamu: <span id="level">1</span> &nbsp;&nbsp; Progress:
    <div class="progress-bar" aria-label="Progress level">
      <div id="progressFill" class="progress-fill"></div>
    </div>
  </div>
</div>

<div id="notificationMessage" role="alert" aria-live="assertive">Notifikasi sudah diizinkan!</div>

<script>
  let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
  let points = parseInt(localStorage.getItem('points')) || 0;
  let level = Math.floor(points / 100) + 1;
  let draggedIndex = null;

  const taskList = document.getElementById('taskList');
  const totalPointsEl = document.getElementById('totalPoints');
  const levelEl = document.getElementById('level');
  const progressFill = document.getElementById('progressFill');
  const searchInput = document.getElementById('searchInput');
  const themeToggleBtn = document.getElementById('themeToggle');
  const notificationMessage = document.getElementById('notificationMessage');

  function saveState() {
    localStorage.setItem('tasks', JSON.stringify(tasks));
    localStorage.setItem('points', points);
    localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
  }

  function updatePoints() {
    totalPointsEl.textContent = points;
    level = Math.floor(points / 100) + 1;
    levelEl.textContent = level;
    const progress = (points % 100);
    progressFill.style.width = progress + '%';
    saveState();
  }

  function renderTasks(filter = 'all', search = '') {
    taskList.innerHTML = '';

    if(tasks.length === 0){
      const emptyMsg = document.createElement('p');
      emptyMsg.textContent = 'Belum ada tugas. Tambah tugas baru yuk!';
      emptyMsg.style.textAlign = 'center';
      emptyMsg.style.padding = '1rem';
      taskList.appendChild(emptyMsg);
      return;
    }

    tasks.forEach((task, index) => {
      if(filter === 'pending' && task.completed) return;
      if(filter === 'completed' && !task.completed) return;
      if(search && !task.text.toLowerCase().includes(search.toLowerCase())) return;

      const li = document.createElement('li');
      li.className = 'task-item';
      if (task.completed) li.classList.add('completed');
      li.draggable = true;
      li.setAttribute('aria-label', 'Tugas: ' + task.text + (task.completed ? ', selesai' : ', belum selesai'));
      li.setAttribute('data-index', index);

      // Drag handle
      const dragHandle = document.createElement('span');
      dragHandle.className = 'drag-handle';
      dragHandle.title = 'Seret untuk mengubah urutan tugas';
      dragHandle.innerHTML = '&#x2630;'; // Hamburger icon as drag handle
      li.appendChild(dragHandle);

      // Checkbox
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = task.completed;
      checkbox.setAttribute('aria-checked', task.completed);
      checkbox.setAttribute('aria-label', 'Tandai tugas selesai');
      checkbox.onchange = () => toggleComplete(index);
      li.appendChild(checkbox);

      // Task text
      const spanText = document.createElement('span');
      spanText.className = 'task-text';
      spanText.textContent = task.text;
      li.appendChild(spanText);

      // Delete button
      const delBtn = document.createElement('button');
      delBtn.className = 'btn-delete';
      delBtn.setAttribute('aria-label', 'Hapus tugas');
      delBtn.textContent = 'Hapus';
      delBtn.onclick = () => deleteTask(index);
      li.appendChild(delBtn);

      // Drag events
      li.addEventListener('dragstart', (e) => {
        draggedIndex = index;
        e.dataTransfer.effectAllowed = 'move';
        li.style.opacity = '0.4';
      });

      li.addEventListener('dragend', () => {
        draggedIndex = null;
        li.style.opacity = '';
      });

      li.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
      });

      li.addEventListener('drop', (e) => {
        e.preventDefault();
        if(draggedIndex === null) return;
        const from = draggedIndex;
        const to = index;
        if(from !== to){
          const movedTask = tasks.splice(from,1)[0];
          tasks.splice(to, 0, movedTask);
          saveState();
          renderTasks(filter, searchInput.value);
        }
      });

      taskList.appendChild(li);
    });
  }

  function toggleComplete(index) {
    tasks[index].completed = !tasks[index].completed;
    if (tasks[index].completed) {
      points += 10; // Poin per tugas selesai
      showNotification('Yeay! Kamu dapat 10 poin.');
      scheduleReminder(tasks[index].text, 5);
    }
    updatePoints();
    saveState();
    renderTasks(currentFilter, searchInput.value);
  }

  function deleteTask(index) {
    if (tasks[index].completed) {
      points -= 10; // Kembalikan poin jika tugas sudah selesai
      if(points < 0) points = 0;
      updatePoints();
    }
    tasks.splice(index, 1);
    saveState();
    renderTasks(currentFilter, searchInput.value);
  }

  // Undo feature (standby)
  let undoStack = [];
  function pushUndo() {
    undoStack.push(JSON.stringify(tasks));
    if (undoStack.length > 20) undoStack.shift();
  }
  function undo() {
    if(undoStack.length > 0){
      tasks = JSON.parse(undoStack.pop());
      saveState();
      renderTasks(currentFilter, searchInput.value);
      updatePoints();
    }
  }

  // Notification reminder for a task (simple demo)
  function scheduleReminder(taskText, minutes) {
    if (!('Notification' in window)) return;
    if (Notification.permission === 'granted') {
      setTimeout(() => {
        new Notification('Pengingat Tugas', {
          body: Jangan lupa selesaikan: ${taskText},
          icon: 'https://cdn-icons-png.flaticon.com/512/747/747310.png'
        });
      }, minutes * 60000);
    }
  }
  function requestNotificationPermission() {
    if (!('Notification' in window)) return;
    if(Notification.permission === 'default'){
      Notification.requestPermission().then(permission => {
        if(permission === 'granted'){
          notificationMessage.style.display = 'block';
          setTimeout(() => {notificationMessage.style.display = 'none'}, 4000);
        }
      });
    }
  }

  // Theme toggle
  function toggleTheme() {
    document.body.classList.toggle('dark');
    themeToggleBtn.textContent = document.body.classList.contains('dark') ? 'â˜€ï¸' : 'ðŸŒ™';
    saveState();
  }
  themeToggleBtn.addEventListener('click', toggleTheme);

  // Search filter
  searchInput.addEventListener('input', (e) => {
    renderTasks(currentFilter, e.target.value);
  });

  // Filter buttons
  let currentFilter = 'all';
  const filterButtons = document.querySelectorAll('.filters button');
  filterButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      currentFilter = btn.id.replace('show', '').toLowerCase();
      filterButtons.forEach(b => {
        b.classList.remove('active');
        b.setAttribute('aria-pressed', 'false');
      });
      btn.classList.add('active');
      btn.setAttribute('aria-pressed', 'true');
      renderTasks(currentFilter, searchInput.value);
    });
  });

  // Form submit
  const taskForm = document.getElementById('taskForm');
  taskForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const input = document.getElementById('taskInput');
    const val = input.value.trim();
    if(val){
      pushUndo();
      tasks.push({ text: val, completed: false });
      input.value = '';
      saveState();
      renderTasks(currentFilter, searchInput.value);
    }
  });

  // Initialize from saved theme
  function loadTheme(){
    const savedTheme = localStorage.getItem('theme');
    if(savedTheme === 'dark'){
      document.body.classList.add('dark');
      themeToggleBtn.textContent = 'â˜€ï¸';
    }
  }

  // Initial render
  loadTheme();
  updatePoints();
  renderTasks();

  // Request notification permission on page load
  window.onload = () => requestNotificationPermission();
</script>
</body>
</html>
